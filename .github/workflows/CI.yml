name: CI

on:
  pull_request:
    paths:
      - '.github/workflows/CI.yml'
      - 'src/**'
      - 'examples/**'
      - 'acinclude.m4'
      - 'bootstrap.sh'
      - 'CMakeLists.txt'
      - 'config/**'
      - 'configure.ac'
      - 'Makefile.in'
  push:
    paths:
      - '.github/workflows/CI.yml'
      - 'src/**'
      - 'examples/**'
      - 'acinclude.m4'
      - 'bootstrap.sh'
      - 'CMakeLists.txt'
      - 'config/**'
      - 'configure.ac'
      - 'Makefile.in'

env:
  GLOBAL_MULTIPLIER: 1

concurrency:
  # Group by workflow and ref, and to limit to 1 concurrent job except for main
  group: ${{ github.workflow }}-${{ github.ref }}-${{ github.ref != 'refs/heads/main' || github.run_number }}
  # Cancel intermediate builds for pull requests
  cancel-in-progress: ${{ startsWith(github.ref, 'refs/pull/') }}

jobs:
  assert-ntl-msolve-nemo:
    name: NTL, msolve and Nemo.jl
    runs-on: ubuntu-24.04
    env:
      CC: "gcc"
      TESTCOEFF: "0.1"
    steps:
      - uses: actions/checkout@v5
      - name: "Setup"
        run: |
          sudo apt-get install -y libgmp-dev libmpfr-dev libntl-dev autoconf libtool-bin
          $CC --version
          make --version
          autoconf --version
          libtool --version
          julia --version
          echo "MAKE=make -j$(expr $(nproc) + 1) --output-sync=target" >> $GITHUB_ENV
      - name: "Build FLINT for msolve"
        run: |
          ./bootstrap.sh && ./configure CC=${CC} --with-ntl --enable-assert
          $MAKE && sudo make install && sudo ldconfig
      - name: "Test msolve"
        run: |
          git clone --depth=1 https://github.com/algebraic-solving/msolve
          cd msolve/ && ./autogen.sh && ./configure && $MAKE && make check

